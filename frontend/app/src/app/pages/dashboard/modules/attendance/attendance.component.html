<!-- Contenedor principal -->
<div class="attendance-container">
  <!-- Encabezado -->
  <div class="attendance-header">
    <div class="header-title">
      <h1>Asistencia</h1>
      <p>Gestiona y visualiza la asistencia de los miembros del gimnasio</p>
    </div>
    <div class="header-actions">
      <button class="btn-action btn-check-in" (click)="registerCheckIn()">
        <span class="icon">‚úì</span>
        Registrar entrada
      </button>
      <button class="btn-action btn-check-out" (click)="registerCheckOut()">
        <span class="icon">‚§∂</span>
        Registrar salida
      </button>
    </div>
  </div>

  <!-- Tarjetas de estad√≠sticas -->
  <div class="stats-cards-container">
    <div class="stats-card">
      <div class="stats-card-header">
        <span class="stats-card-title">Asistencia hoy</span>
        <span class="stats-card-icon">üë•</span>
      </div>
      <div class="stats-card-value">{{ attendanceToday }}</div>
      <div class="stats-card-detail">+{{ attendancePercentage }}% vs. promedio</div>
    </div>
    <div class="stats-card">
      <div class="stats-card-header">
        <span class="stats-card-title">Miembros actuales</span>
        <span class="stats-card-icon">üë§</span>
      </div>
      <div class="stats-card-value">{{ activeMembers }}</div>
      <div class="stats-card-detail">{{ activeMembersPercentage }}% de miembros activos</div>
    </div>
    <div class="stats-card">
      <div class="stats-card-header">
        <span class="stats-card-title">Hora pico hoy</span>
        <span class="stats-card-icon">‚è∞</span>
      </div>
      <div class="stats-card-value">{{ peakHourStart }} - {{ peakHourEnd }}</div>
      <div class="stats-card-detail">Promedio de {{ peakHourCount }} personas</div>
    </div>
    <div class="stats-card">
      <div class="stats-card-header">
        <span class="stats-card-title">Miembros inactivos</span>
        <span class="stats-card-icon">‚ö†Ô∏è</span>
      </div>
      <div class="stats-card-value">{{ inactiveMembers }}</div>
      <div class="stats-card-detail">Sin asistencia en los √∫ltimos {{ inactiveDays }} d√≠as</div>
    </div>
  </div>

  <!-- Barra de b√∫squeda y filtros -->
  <div class="search-filter-container">
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input type="text" placeholder="Buscar por nombre de miembro..." [(ngModel)]="searchTerm">
    </div>
    <div class="filter-actions">
      <div class="date-selector">
        <button class="date-nav-btn" (click)="changeDate('prev')">
          <span>&lt;</span>
        </button>
        <div class="current-date">
          <span class="date-icon">üìÖ</span>
          <span>{{ formatDate(currentDate) }}</span>
        </div>
        <button class="date-nav-btn" (click)="changeDate('next')">
          <span>&gt;</span>
        </button>
      </div>
      <div class="filter-dropdown">
        <span>Todos los registros</span>
        <span class="dropdown-arrow">‚ñº</span>
      </div>
      <button class="btn-export" (click)="exportRecords()">
        <span class="export-icon">üìä</span>
        Exportar
      </button>
    </div>
  </div>

  <!-- Pesta√±as de navegaci√≥n -->
  <div class="tabs-container">
    <div class="tab" [class.active]="selectedTab === 'records'" (click)="setActiveTab('records')">Registros</div>
    <div class="tab" [class.active]="selectedTab === 'members'" (click)="setActiveTab('members')">Miembros</div>
    <div class="tab" [class.active]="selectedTab === 'statistics'" (click)="setActiveTab('statistics')">Estad√≠sticas</div>
  </div>

  <!-- Contenido de las pesta√±as -->
  <!-- Pesta√±a de Registros -->
  <div *ngIf="selectedTab === 'records'" class="records-container">
    <div class="records-table-header">
      <div class="records-title">
        <h2>Asistencia por miembro</h2>
        <p>Visualiza la frecuencia de asistencia de cada miembro</p>
      </div>
    </div>
    <table class="records-table">
      <thead>
        <tr>
          <th class="checkbox-column"><input type="checkbox"></th>
          <th>Miembro</th>
          <th>√öltima asistencia</th>
          <th>Frecuencia</th>
          <th>Asistencias (mes)</th>
          <th class="actions-column">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of filterMembers()">
          <td class="checkbox-column"><input type="checkbox"></td>
          <td class="member-column">
            <div class="member-avatar"></div>
            <div>
              <div>{{ member.name }}</div>
              <div *ngIf="member.membershipType" class="member-type">{{ member.membershipType }} <span *ngIf="member.isActive" class="member-status">‚Ä¢ Activo</span></div>
            </div>
          </td>
          <td>
            <div>{{ member.lastAttendanceDate }} {{ member.lastAttendanceTime }}</div>
            <div class="attendance-detail" *ngIf="member.lastAttendanceDays">hace {{ member.lastAttendanceDays }} d√≠a(s)</div>
          </td>
          <td>
            <span class="frequency-badge" [ngClass]="getFrequencyClass(member.frequency)">{{ member.frequency || 'N/A' }}</span>
          </td>
          <td>{{ member.attendanceCount }}</td>
          <td class="actions-column">
            <button class="btn-view-history" (click)="viewHistory(member.id)">Ver historial</button>
            <button class="btn-register" (click)="registerAttendance(member.id)">Registrar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pesta√±a de Miembros -->
  <div *ngIf="selectedTab === 'members'" class="members-container">
    <div class="members-table-header">
      <div class="members-title">
        <h2>Lista de miembros</h2>
        <p>Informaci√≥n detallada de todos los miembros</p>
      </div>
    </div>
    <table class="members-table">
      <thead>
        <tr>
          <th class="checkbox-column"><input type="checkbox"></th>
          <th>Miembro</th>
          <th>Membres√≠a</th>
          <th>Estado</th>
          <th>√öltima asistencia</th>
          <th>Frecuencia</th>
          <th class="actions-column">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of members">
          <td class="checkbox-column"><input type="checkbox"></td>
          <td class="member-column">
            <div class="member-avatar"></div>
            <div>{{ member.name }}</div>
          </td>
          <td>{{ member.membershipType || 'N/A' }}</td>
          <td><span class="status-badge" [class.active]="member.isActive">{{ member.isActive ? 'Activo' : 'Inactivo' }}</span></td>
          <td>{{ member.lastAttendanceDate || member.lastAttendance || 'N/A' }}</td>
          <td>
            <span class="frequency-badge" [ngClass]="getFrequencyClass(member.frequency)">{{ member.frequency || 'N/A' }}</span>
          </td>
          <td class="actions-column">
            <button class="btn-view-history" (click)="viewHistory(member.id)">Ver historial</button>
            <button *ngIf="member.isActive" class="btn-register" (click)="registerAttendance(member.id)">Registrar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pesta√±a de Estad√≠sticas -->
  <div *ngIf="selectedTab === 'statistics'" class="statistics-container">
    <!-- Gr√°ficos de asistencia -->
    <div class="stats-row">
      <div class="stats-card-wide">
        <div class="stats-card-header">
          <h3>Asistencia por d√≠a de la semana</h3>
          <p>Promedio de asistencias por d√≠a</p>
        </div>
        <div class="chart-container">
          <!-- Aqu√≠ ir√≠a un gr√°fico de barras -->
          <div class="placeholder-chart">
            <div *ngFor="let day of weekdayAttendance" class="chart-bar" [style.height.px]="day.count * 2">
              <div class="bar-value">{{ day.count }}</div>
              <div class="bar-label">{{ day.day.substring(0, 3) }}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="stats-card-wide">
        <div class="stats-card-header">
          <h3>Asistencia por hora del d√≠a</h3>
          <p>Distribuci√≥n de asistencias durante el d√≠a</p>
        </div>
        <div class="chart-container">
          <!-- Aqu√≠ ir√≠a un gr√°fico de l√≠neas -->
          <div class="placeholder-chart">
            <div *ngFor="let hour of hourlyAttendance" class="chart-bar" [style.height.px]="hour.count * 2">
              <div class="bar-value">{{ hour.count }}</div>
              <div class="bar-label">{{ hour.hour }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="stats-card-full">
      <div class="stats-card-header">
        <h3>Tendencia de asistencia mensual</h3>
        <p>Total de asistencias por mes</p>
      </div>
      <div class="chart-container">
        <!-- Aqu√≠ ir√≠a un gr√°fico de √°rea -->
        <div class="placeholder-chart">
          <div *ngFor="let month of monthlyAttendance" class="chart-bar-wide" [style.height.px]="month.count / 10">
            <div class="bar-value">{{ month.count }}</div>
            <div class="bar-label">{{ month.month }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- M√©tricas clave -->
    <div class="stats-row">
      <div class="stats-metric-card">
        <div class="metric-title">Duraci√≥n promedio</div>
        <div class="metric-subtitle">Tiempo promedio de permanencia</div>
        <div class="metric-value">{{ averageDuration }} min</div>
        <div class="metric-detail">La duraci√≥n promedio de visita ha aumentado un {{ durationIncrease }}% respecto al mes anterior.</div>
      </div>
      <div class="stats-metric-card">
        <div class="metric-title">Tasa de retenci√≥n</div>
        <div class="metric-subtitle">Miembros que asisten regularmente</div>
        <div class="metric-value">{{ retentionRate }}%</div>
        <div class="metric-detail">El {{ retentionRate }}% de los miembros asiste al menos 2 veces por semana.</div>
      </div>
      <div class="stats-metric-card">
        <div class="metric-title">Miembros en riesgo</div>
        <div class="metric-subtitle">Sin asistencia en los √∫ltimos 14 d√≠as</div>
        <div class="metric-value">{{ atRiskPercentage }}%</div>
        <div class="metric-detail">Se recomienda contactar a estos miembros para evitar cancelaciones.</div>
      </div>
    </div>
  </div>
</div>
